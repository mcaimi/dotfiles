# i3-gaps configuration file

set $internal "LVDS1"
set $external "VGA1"

# i3 font
set $sz 10
set $szbar 11
set $sz_small 9
set $ft_i3 Iosevka Term Medium
set $ft_i3blocks Iosevka Nerd Font Regular
set $ft_awesome Font Awesome 5 Free
font pango:$ft_i3,$ft_awesome $sz

# read colors from xresources database
set_from_resource $darkred     color1  #000000
set_from_resource $red         color9  #000000
set_from_resource $darkgreen   color2  #000000
set_from_resource $green       color10 #000000
set_from_resource $darkyellow  color3  #000000
set_from_resource $yellow      color11 #000000
set_from_resource $darkblue    color4  #000000
set_from_resource $blue        color12 #000000
set_from_resource $darkmagenta color5  #000000
set_from_resource $magenta     color13 #000000
set_from_resource $darkcyan    color6  #000000
set_from_resource $cyan        color14 #000000
set_from_resource $darkwhite   color7  #000000
set_from_resource $white       color15 #000000

# Use custom colors for black
set_from_resource $black       color8 #282828
set_from_resource $darkblack   color0 #1d2021
set_from_resource $transparent transparent #00000000

# mod key -> Windows Key on laptop
set $mod Mod4
set $alt Mod1
set $TERMINAL /usr/bin/st
set $ALT_TERMINAL /usr/bin/kitty
set $DMENU /usr/bin/rofi -show combi
set $DMENU_TABS /usr/bin/rofi -show window
set $DMENU_RUN /usr/bin/rofi -separator-style none -lines 0 -dmenu -p "~ > " -show run
set $SANDFOX docker start sandfox
set $TOTP_CMD /usr/local/bin/totp.sh
set $window_border_thickness 3

# i3-gaps settings
set $gaps_inner_px 8
set $gaps_outer_px 6
set $gaps_delta 2
gaps inner $gaps_inner_px
gaps outer $gaps_outer_px
popup_during_fullscreen smart
smart_borders on
smart_gaps on

# i3blocks
set $i3blocks_height_top 24
set $i3blocks_height_bottom 20
set $polybar_placeholder_top_height 20
set $polybar_placeholder_bottom_height 18

# set window classes properties
for_window [class="^.*"] border pixel $window_border_thickness
hide_edge_borders smart
for_window [class="(?i).+-256color"] title_format " >_ %title "

# colors & theme settings
#                       BORDER        BACKGROUND      TEXT        INDICATOR   CHILD_BORDER
client.focused          $white        $black          $white      $white      $blue
client.unfocused        $cyan         $transparent    $white      $black      $black
client.focused_inactive $yellow       $transparent    $white      $black      $black
client.urgent           $red          $red            $black      $red        $red
client.background       $black

# Keyboard Shortcuts definitions

# i3 related
bindsym $mod+Control+c reload
bindsym $mod+Control+r restart

# behaviour related
bindsym $mod+q kill
bindsym $mod+f fullscreen toggle

# Setup Workspaces
# Terminal
set $ws1 1:  Terminal
# Browser
set $ws2 2:  Internet
# Code
set $ws3 3:  Coding
# Media
set $ws4 4:  Multimedia
# Photography
set $ws5 5:  Photography
# Documents
set $ws6 6:  Documents
# Virtual Machines
set $ws7 7:  VirtualMachine
# Chat
set $ws8 8:  Chat
# Filesystem
set $ws9 9:  Filesystem
# Games
set $ws0 10:  Games

# workspaces shortcuts
bindsym $mod+1 workspace $ws1
bindsym $mod+2 workspace $ws2
bindsym $mod+3 workspace $ws3
bindsym $mod+4 workspace $ws4
bindsym $mod+5 workspace $ws5
bindsym $mod+6 workspace $ws6
bindsym $mod+7 workspace $ws7
bindsym $mod+8 workspace $ws8
bindsym $mod+9 workspace $ws9
bindsym $mod+0 workspace $ws0
bindsym $alt+Tab workspace back_and_forth

# Scratchpad
bindsym $mod+Shift+minus move scratchpad
bindsym $mod+minus scratchpad show

# Workspace assignment
assign [class="(?i)st"] $ws1
assign [class="(?i).+-256color"] $ws1
assign [class="(?i)firefox"] $ws2
assign [class="(?i)qutebrowser"] $ws2
assign [class="(?i)code"] $ws3
assign [title="Spotify"] $ws4
assign [class="(?i)darktable"] $ws5
assign [class="(?i)rawtherapee"] $ws5
assign [class="(?i)gimp"] $ws5
assign [class="(?I)zathura"] $ws6
assign [class="(?i)xfreerdp"] $ws7
assign [class="(?i)virt-manager"] $ws7
assign [class="(?i)keybase"] $ws8
assign [class="(?i)thunar"] $ws9
assign [class="(?i)retroarch"] $ws0
assign [title="Steam"] $ws0

# Move containers
bindsym $mod+Shift+1 move container to workspace $ws1
bindsym $mod+Shift+2 move container to workspace $ws2
bindsym $mod+Shift+3 move container to workspace $ws3
bindsym $mod+Shift+4 move container to workspace $ws4
bindsym $mod+Shift+5 move container to workspace $ws5
bindsym $mod+Shift+6 move container to workspace $ws6
bindsym $mod+Shift+7 move container to workspace $ws7
bindsym $mod+Shift+8 move container to workspace $ws8
bindsym $mod+Shift+9 move container to workspace $ws9

# focus movement
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# window movement
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

# Window markings
bindsym $mod+m exec i3-input -F 'mark %s' -l 10 -P 'Mark Active Window: '
bindsym $mod+g exec i3-input -F '[con_mark="%s"] focus' -l 10 -P 'Go to Mark: '


# workspace splits
bindsym $alt+$mod+f floating toggle
bindsym $alt+$mod+e layout toggle split 
bindsym $alt+$mod+s layout stacking 
bindsym $alt+$mod+w layout tabbed
bindsym $alt+$mod+v split v;exec notify-send "i3: Split Mode: Horizontal"
bindsym $alt+$mod+h split h;exec notify-send "i3: Split Mode: Vertical"
bindsym $mod+Shift+f exec --no-startup-id $HOME/.config/i3scripts/i3_fullscreen.sh &

# WM Modes
mode "Window_Resize" {
    bindsym Left resize shrink width 5 px or 5 ppt
    bindsym Down resize grow height 5 px or 5 ppt
    bindsym Up resize shrink height 5 px or 5 ppt
    bindsym Right resize grow width 5 px or 5 ppt

    bindsym h resize shrink width 5 px or 5 ppt
    bindsym j resize grow height 5 px or 5 ppt
    bindsym k resize shrink height 5 px or 5 ppt
    bindsym l resize grow width 5 px or 5 ppt

    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $mod+Shift+r mode "Window_Resize"

mode "i3_gaps" {
  bindsym o mode "i3_gaps_outer"
  bindsym i mode "i3_gaps_inner"

  bindsym d exec --no-startup-id i3-msg "gaps outer all set $gaps_outer_px" && i3-msg "gaps inner all set $gaps_inner_px"
  bindsym 0 exec --no-startup-id i3-msg "gaps outer all set 0" && i3-msg "gaps inner all set 0" && i3-msg "smart_borders no-gaps"
  bindsym b exec --no-startup-id i3-msg "border toggle"

  bindsym Return mode "default"
  bindsym Escape mode "default"
}
bindsym $mod+Shift+g mode "i3_gaps"
mode "i3_gaps_outer" {
  bindsym plus exec i3-msg "gaps outer current plus $gaps_delta"
  bindsym minus exec i3-msg "gaps outer current minus $gaps_delta"

  bindsym Return mode "default"
  bindsym Escape mode "default"
}
mode "i3_gaps_inner" {
  bindsym plus exec i3-msg "gaps inner current plus $gaps_delta"
  bindsym minus exec i3-msg "gaps inner current minus $gaps_delta"

  bindsym Return mode "default"
  bindsym Escape mode "default"
}

mode "Power_Management" {
    bindsym l exec --no-startup-id $HOME/.config/i3/i3pm lock
    bindsym e exec --no-startup-id $HOME/.config/i3/i3pm logout
    bindsym r exec --no-startup-id $HOME/.config/i3/i3pm reboot
    bindsym s exec --no-startup-id $HOME/.config/i3/i3pm shutdown

    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $mod+Shift+e mode "Power_Management"

mode "XRandr" {
    bindsym l exec --no-startup-id $HOME/.config/i3scripts/multimon.sh "extleft" && i3-msg restart
    bindsym r exec --no-startup-id $HOME/.config/i3scripts/multimon.sh "extright" && i3-msg restart
    bindsym m exec --no-startup-id $HOME/.config/i3scripts/multimon.sh "mirror" && i3-msg restart
    bindsym d exec --no-startup-id $HOME/.config/i3scripts/multimon.sh "dock" && i3-msg restart
    bindsym u exec --no-startup-id $HOME/.config/i3scripts/multimon.sh "undock" && i3-msg restart
    bindsym p exec --no-startup-id $HOME/.config/i3scripts/multimon.sh "panic" && i3-msg restart

    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $mod+Shift+x mode "XRandr"

# Custom Shortcuts
# Base behaviour, terminal and dmenu
bindsym $mod+d exec --no-startup-id $DMENU
bindsym Menu exec --no-startup-id $DMENU
bindsym $mod+w exec --no-startup-id $DMENU_TABS
bindsym $mod+s exec --no-startup-id $DMENU_RUN
# st with TMUX, the default
bindsym $mod+Return exec --no-startup-id $TERMINAL -e tmux
# alternate terminal
bindsym $mod+$alt+Return exec --no-startup-id $ALT_TERMINAL
# Plain old Xst, just the terminal
bindsym $mod+Shift+Return exec --no-startup-id $TERMINAL
# TOTP
bindsym $mod+t exec --no-startup-id $TOTP_CMD &

# Volume & music shortcuts
bindsym XF86AudioMute exec $HOME/.config/i3scripts/pulsectl.py -m &
bindsym XF86AudioLowerVolume exec $HOME/.config/i3scripts/pulsectl.py -l 5 &
bindsym XF86AudioRaiseVolume exec $HOME/.config/i3scripts/pulsectl.py -r 5 &

# Screen Backlight
bindsym XF86MonBrightnessDown exec xbacklight -10 &
bindsym XF86MonBrightnessUp exec xbacklight +10 &

# screen lock shortcut
bindsym $mod+Shift+l exec $HOME/.config/i3lock/i3lock.sh

# XRandr 
# randr menu (X11 hotkey)
bindsym XF86Display exec --no-startup-id $HOME/.config/i3scripts/multimon-rofi.sh &
# Xrandr menu (alt hotkey)
bindsym $mod+Shift+Control+x exec --no-startup-id $HOME/.config/i3scripts/multimon-rofi.sh &
# panic mode (fircefully reverts to the internal laptop monitor)
bindsym $mod+XF86Display exec --no-startup-id $HOME/.config/i3scripts/multimon.sh "panic" && i3-msg restart

# custom keybindings for most used applications
bindsym $mod+r exec --no-startup-id st -e ranger &

# NetworkManager menu
bindsym $mod+Shift+n exec --no-startup-id networkmanager_dmenu &
# Screenshot menu
bindsym $mod+Shift+s exec --no-startup-id $HOME/Work/dotfiles/rofi-screenshot.sh &

# mouse bindings
bindsym --whole-window $mod+Shift+button2 floating toggle
bindsym --whole-window $mod+$alt+button2 exec --no-startup-id $HOME/.config/i3scripts/i3_fullscreen.sh &

# Window properties by X11 class
for_window [class="(?i)mpv"] floating enable
for_window [class="(?i)gimp"] floating enable
for_window [class="(?i)evince"] floating enable
for_window [window_role="(?i)pop-up"] floating enable
for_window [window_role="(?i)about"] floating enable
for_window [class="(?i)keepassxc"] move to scratchpad
for_window [class="(?i)glava"] border pixel 0

# https://github.com/ValveSoftware/steam-for-linux/issues/1040
for_window [class="^Steam$" title="^Friends$"] floating enable
for_window [class="^Steam$" title="Steam - News"] floating enable
for_window [class="^Steam$" title=".* - Chat"] floating enable
for_window [class="^Steam$" title="^Settings$"] floating enable
for_window [class="^Steam$" title=".* - event started"] floating enable
for_window [class="^Steam$" title=".* CD key"] floating enable
for_window [class="^Steam$" title="^Steam - Self Updater$"] floating enable
for_window [class="^Steam$" title="^Screenshot Uploader$"] floating enable
for_window [class="^Steam$" title="^Steam Guard - Computer Authorization Required$"] floating enable
for_window [title="^Steam Keyboard$"] floating enable

# i3bar & i3blocks
bar {
  mode dock
  i3bar_command i3bar -t
  status_command i3blocks -c $HOME/.config/i3blocks/i3blocks_top.conf
  font pango:$ft_i3blocks $szbar
  id bar-top
  position top
  output $external
  output $internal
  modifier none
  separator_symbol ""
  tray_output none
  workspace_buttons yes
  strip_workspace_numbers yes
  binding_mode_indicator no
  height $i3blocks_height_top
  colors {
    #background <color>
    #statusline <color>
    #separator <color>
    #
    #<colorclass> <border> <background> <text>

    background $darkblack
    #statusline $darkwhite

    focused_background $darkblack $darkblack $darkblack
    focused_statusline $white $darkblack $white
    focused_separator $darkwhite $darkblack $darkblack
    active_workspace $darkblack $darkblack $magenta
    focused_workspace $darkblack $darkblack $white
    inactive_workspace $darkblack $darkblack $cyan
    urgent_workspace $darkblack $darkblack $red
    binding_mode $darkblack $darkred $darkblack
  }
}
bar {
  mode hide
  i3bar_command i3bar -t
  status_command i3blocks -c $HOME/.config/i3blocks/i3blocks_bottom.conf
  font pango:$ft_i3blocks $sz_small
  id bar-bottom
  output $external
  output $internal
  position bottom
  modifier none
  tray_output $external
  tray_output $internal
  tray_padding 3
  workspace_buttons no
  binding_mode_indicator yes
  height $i3blocks_height_bottom
  colors {
   #background <color>
   #statusline <color>
   #separator <color>
   #
   #<colorclass> <border> <background> <text>
   background $darkblack

   focused_background $darkblack $darkblack $darkblack
   focused_statusline $white $darkblack $darkblack
   focused_separator $darkwhite $darkblack $darkblack
   active_workspace $darkblack $darkblack $magenta
   focused_workspace $darkblack $darkblack $white
   inactive_workspace $darkblack $darkblack $cyan
   urgent_workspace $darkblack $darkblack $red
   binding_mode $darkblack $darkblack $white
 }
}
bindsym $mod+z bar mode toggle bar-bottom

# placeholder for polybar
# DISABLED
#bar {
#  id bar-top-int
#  modifier none
#  tray_output none
#  output $internal
#  height $polybar_placeholder_top_height
#  position top
#  workspace_buttons no
#  binding_mode_indicator no
#  colors {
#    background $transparent
#  }
#}
#bar {
#  id bar-bot-int
#  modifier none
#  tray_output none
#  output $internal
#  height $polybar_placeholder_bottom_height
#  position bottom
#  workspace_buttons no
#  binding_mode_indicator no
#  colors {
#    background $transparent
#  }
#}

# Exec and startup
# setup environment
exec_always --no-startup-id $HOME/.config/i3/setup_environment.sh &

# feh for background
exec_always --no-startup-id wal -i $HOME/.config/i3walls/wallpaper.jpg &

# start systray applets
exec_always --no-startup-id $HOME/.config/i3/start_applets.sh &

# polybar top & bottom widgets, only on internal display
# Disable for now
#exec_always --no-startup-id $HOME/.config/polybar/load.sh &

# start conky
# exec_always --no-startup-id $HOME/.conkystart.sh &
